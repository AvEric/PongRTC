{"ts":1354652931093,"silentsave":true,"restoring":false,"patch":[[{"diffs":[[1,"//CLIENT\n\n // Fallbacks for vendor-specific variables until the spec is finalized.\n\t\nvar PeerConnection = window.PeerConnection || window.webkitPeerConnection00 || window.webkitRTCPeerConnection;\nvar URL = window.URL || window.webkitURL || window.msURL || window.oURL;\nvar getUserMedia = navigator.getUserMedia || navigator.webkitGetUserMedia || navigator.mozGetUserMedia || navigator.msGetUserMedia;\n\n(function() {\n\n  var rtc;\n  if ('undefined' === typeof module) {\n    rtc = this.rtc = {};\n  } else {\n    rtc = module.exports = {};\n  }\n\n \n  // Holds a connection to the server.\n  rtc._socket = null;\n\n  // Holds callbacks for certain events.\n  rtc._events = {};\n\n  rtc.on = function(eventName, callback) {\n    rtc._events[eventName] = rtc._events[eventName] || [];\n    rtc._events[eventName].push(callback);\n  };\n\n  rtc.fire = function(eventName, _) {\n    var events = rtc._events[eventName];\n    var args = Array.prototype.slice.call(arguments, 1);\n\n    if (!events) {\n      return;\n    }\n\n    for (var i = 0, len = events.length; i < len; i++) {\n      events[i].apply(null, args);\n    }\n  };\n\n  // Holds the STUN/ICE server to use for PeerConnections.\n  rtc.SERVER = {iceServers:[{url:\"stun:stun.l.google.com:19302\"}]};\n\n  // Referenc e to the lone PeerConnection instance.\n  rtc.peerConnections = {};\n\n  // Array of known peer socket ids\n  rtc.connections = [];\n  // Stream-related variables.\n  rtc.streams = [];\n  rtc.numStreams = 0;\n  rtc.initializedStreams = 0;\n\n  /**\n   * Connects to the websocket server.\n   */\n  rtc.connect = function(server, room) {\n    room = room || \"\"; // by default, join a room called the blank string\n    rtc._socket = new WebSocket(server);\n\n    rtc._socket.onopen = function() {\n\n      rtc._socket.send(JSON.stringify({\n        \"eventName\": \"join_room\",\n        \"data\":{\n          \"room\": room\n        }\n      }), function(error){\n          if(error){console.log(error);}\n        });\n\n      rtc._socket.onmessage = function(msg) {\n        var json = JSON.parse(msg.data);\n        rtc.fire(json.eventName, json.data);\n      };\n\n      rtc._socket.onerror = function(err) {\n        console.log('onerror');\n        console.log(err);\n      };\n\n      rtc._socket.onclose = function(data) {\n        rtc.fire('disconnect stream', rtc._socket.id);\n        delete rtc.peerConnections[rtc._socket.id];\n      };\n\n      rtc.on('get_peers', function(data) {\n        rtc.connections = data.connections;\n        // fire connections event and pass peers\n        rtc.fire('connections', rtc.connections);\n      });\n\n      rtc.on('receive_ice_candidate', function(data) {\n    \tvar candidate = new RTCIceCandidate(data);\n    \trtc.peerConnections[data.socketId].addIceCandidate(candidate);\n        rtc.fire('receive ice candidate', candidate);\n      });\n\n      rtc.on('new_peer_connected', function(data) {\n        rtc.connections.push(data.socketId);\n\n        var pc = rtc.createPeerConnection(data.socketId);\n        for (var i = 0; i < rtc.streams.length; i++) {\n          var stream = rtc.streams[i];\n          pc.addStream(stream);\n        }\n      });\n\n      rtc.on('remove_peer_connected', function(data) {  \n        rtc.fire('disconnect stream', data.socketId);\n        delete rtc.peerConnections[data.socketId];\n      });\n\n      rtc.on('receive_offer', function(data) {\n        rtc.receiveOffer(data.socketId, data.sdp);\n        rtc.fire('receive offer', data);\n      });\n\n      rtc.on('receive_answer', function(data) {\n        rtc.receiveAnswer(data.socketId, data.sdp);\n        rtc.fire('receive answer', data);\n      });\n\n      rtc.fire('connect');\n    };\n  };\n\n\n  rtc.sendOffers = function() {\n    for (var i = 0, len = rtc.connections.length; i < len; i++) {\n      var socketId = rtc.connections[i];\n      rtc.sendOffer(socketId);\n    }\n  }\n\n  rtc.onClose = function(data) {\n    rtc.on('close_stream', function() {\n      rtc.fire('close_stream', data);\n    });\n  }\n\n  rtc.createPeerConnections = function() {\n    for (var i = 0; i < rtc.connections.length; i++) {\n      rtc.createPeerConnection(rtc.connections[i]);\n    }\n  };\n\n  rtc.createPeerConnection = function(id) {\n    console.log('createPeerConnection');\n    var pc = rtc.peerConnections[id] = new PeerConnection(rtc.SERVER);\n    pc.onicecandidate = function(event) {\n      if (event.candidate) {\n         rtc._socket.send(JSON.stringify({\n           \"eventName\": \"send_ice_candidate\",\n           \"data\": {\n              \"label\": event.candidate.label,\n              \"candidate\": event.candidate.candidate,\n              \"socketId\": id\n           }\n         }), function(error){\n           if(error){console.log(error);}\n         });\n       }\n       rtc.fire('ice candidate', event.candidate);\n     };\n\n    pc.onopen = function() {\n      // TODO: Finalize this API\n      rtc.fire('peer connection opened');\n    };\n\n    pc.onaddstream = function(event) {\n      // TODO: Finalize this API\n      rtc.fire('add remote stream', event.stream, id);\n    };\n    return pc;\n  };\n\n  rtc.sendOffer = function(socketId) {\n    var pc = rtc.peerConnections[socketId];\n    pc.createOffer( function(session_description) {\n    pc.setLocalDescription(session_description);\n    rtc._socket.send(JSON.stringify({\n        \"eventName\": \"send_offer\",\n        \"data\":{\n            \"socketId\": socketId,\n            \"sdp\": session_description\n            }\n        }), function(error){\n            if(error){console.log(error);\n        }\n   });\n    });\n  };\n\n\n  rtc.receiveOffer = function(socketId, sdp) {\n    var pc = rtc.peerConnections[socketId];\n    pc.setRemoteDescription(new RTCSessionDescription(sdp));\n    rtc.sendAnswer(socketId);\n  };\n\n\n  rtc.sendAnswer = function(socketId) {\n    var pc = rtc.peerConnections[socketId];\n    pc.createAnswer( function(session_description) {\n    pc.setLocalDescription(session_description);\n    rtc._socket.send(JSON.stringify({\n        \"eventName\": \"send_answer\",\n        \"data\":{\n            \"socketId\": socketId,\n            \"sdp\": session_description\n            }\n        }), function(error){\n            if(error){console.log(error);\n        }\n   });\n    var offer = pc.remoteDescription;\n    });\n  };\n\n\n  rtc.receiveAnswer = function(socketId, sdp) {\n    var pc = rtc.peerConnections[socketId];\n    pc.setRemoteDescription(new RTCSessionDescription(sdp));\n  };\n\n\n  rtc.createStream = function(opt, onSuccess, onFail) {\n    var options;\n    onSuccess = onSuccess ||\n    function() {};\n    onFail = onFail ||\n    function() {};\n\n    if(opt.audio && opt.video){\n      options = {\n        video: true,\n        audio: true\n      };\n    }else if(opt.video){\n      options = {\n        video: true,\n        audio: false\n      };\n    }else if(opt.audio){\n      options = {\n        video: false,\n        audio: true\n      };\n    }else {\n      options = {\n        video: false,\n        audio: false\n      };\n    }\n\n    if (getUserMedia) {\n      rtc.numStreams++;\n      getUserMedia.call(navigator, options, function(stream) {\n        \n        rtc.streams.push(stream);\n        rtc.initializedStreams++;\n        onSuccess(stream);\n        if (rtc.initializedStreams === rtc.numStreams) {\n          rtc.fire('ready');\n        }\n      }, function() {\n        alert(\"Could not connect stream.\");\n        onFail();\n      });\n    } else {\n      alert('webRTC is not yet supported in this browser.');\n    }\n  }\n\n\n  rtc.addStreams = function() {\n    for (var i = 0; i < rtc.streams.length; i++) {\n      var stream = rtc.streams[i];\n      for (var connection in rtc.peerConnections) {\n        rtc.peerConnections[connection].addStream(stream);\n      }\n    }\n  };\n\n\n  rtc.attachStream = function(stream, domId) {\n    document.getElementById(domId).src = URL.createObjectURL(stream);\n  };\n\n  rtc.on('ready', function() {\n    rtc.createPeerConnections();\n    rtc.addStreams();\n    rtc.sendOffers();\n  });\n\n}).call(this);\n"]],"start1":0,"start2":0,"length1":0,"length2":7812}]],"length":7812}
{"contributors":[],"silentsave":true,"ts":1354652973035,"patch":[[{"diffs":[[0,"//CLIENT"],[-1,"\n"],[1,"\r\n\r"],[0,"\n // Fal"]],"start1":0,"start2":0,"length1":17,"length2":19},{"diffs":[[0,"zed."],[-1,"\n\t"],[1,"\r\n    \r"],[0,"\nvar"]],"start1":80,"start2":80,"length1":10,"length2":15},{"diffs":[[0,"n ||"],[-1," window.webkitPeerConnection00 ||"],[0," win"]],"start1":133,"start2":133,"length1":41,"length2":8},{"diffs":[[0,"nection;"],[1,"\r"],[0,"\nvar URL"]],"start1":161,"start2":161,"length1":16,"length2":17},{"diffs":[[0,"ow.oURL;"],[1,"\r"],[0,"\nvar get"]],"start1":235,"start2":235,"length1":16,"length2":17},{"diffs":[[0,"erMedia;"],[-1,"\n"],[1,"\r\n\r"],[0,"\n(functi"]],"start1":368,"start2":368,"length1":17,"length2":19},{"diffs":[[0,"tion() {"],[-1,"\n"],[1,"\r\n\r"],[0,"\n  var r"]],"start1":385,"start2":385,"length1":17,"length2":19},{"diffs":[[0,"var rtc;"],[1,"\r"],[0,"\n  if ('"]],"start1":399,"start2":399,"length1":16,"length2":17},{"diffs":[[0,"of module) {"],[1,"\r"],[0,"\n    rtc = t"]],"start1":435,"start2":435,"length1":24,"length2":25},{"diffs":[[0,"is.rtc = {};"],[1,"\r"],[0,"\n  } else {\n"]],"start1":461,"start2":461,"length1":24,"length2":25},{"diffs":[[0,"\r\n  } else {"],[1,"\r"],[0,"\n    rtc = m"]],"start1":473,"start2":473,"length1":24,"length2":25},{"diffs":[[0,"ts = {};"],[1,"\r"],[0,"\n  }"],[-1,"\n"],[1,"\r\n\r"],[0,"\n "],[1,"\r"],[0,"\n  // Ho"]],"start1":509,"start2":509,"length1":23,"length2":27},{"diffs":[[0," server."],[1,"\r"],[0,"\n  rtc._"]],"start1":559,"start2":559,"length1":16,"length2":17},{"diffs":[[0," = null;"],[-1,"\n"],[1,"\r\n  \r\n  // Holds identity for the client\r\n  rtc._me = null;\r\n\r"],[0,"\n  // Ho"]],"start1":582,"start2":582,"length1":17,"length2":78},{"diffs":[[0," events."],[1,"\r"],[0,"\n  rtc._"]],"start1":685,"start2":685,"length1":16,"length2":17},{"diffs":[[0,"ts = {};"],[-1,"\n"],[1,"\r\n\r"],[0,"\n  rtc.o"]],"start1":706,"start2":706,"length1":17,"length2":19},{"diffs":[[0,"lback) {"],[1,"\r"],[0,"\n    rtc"]],"start1":752,"start2":752,"length1":16,"length2":17},{"diffs":[[0,"] || [];"],[1,"\r"],[0,"\n    rtc"]],"start1":812,"start2":812,"length1":16,"length2":17},{"diffs":[[0,"llback);"],[1,"\r"],[0,"\n  };"],[-1,"\n"],[1,"\r\n\r"],[0,"\n  rtc.f"]],"start1":856,"start2":856,"length1":22,"length2":25},{"diffs":[[0,"me, _) {"],[1,"\r"],[0,"\n    var"]],"start1":903,"start2":903,"length1":16,"length2":17},{"diffs":[[0,"ntName];"],[1,"\r"],[0,"\n    var"]],"start1":945,"start2":945,"length1":16,"length2":17},{"diffs":[[0,"nts, 1);"],[-1,"\n"],[1,"\r\n\r"],[0,"\n    if "]],"start1":1003,"start2":1003,"length1":17,"length2":19},{"diffs":[[0," (!events) {"],[1,"\r"],[0,"\n      retur"]],"start1":1021,"start2":1021,"length1":24,"length2":25},{"diffs":[[0," return;"],[1,"\r"],[0,"\n    }"],[-1,"\n"],[1,"\r\n\r"],[0,"\n    for"]],"start1":1040,"start2":1040,"length1":23,"length2":26},{"diffs":[[0," len; i++) {"],[1,"\r"],[0,"\n      event"]],"start1":1103,"start2":1103,"length1":24,"length2":25},{"diffs":[[0,", args);"],[1,"\r"],[0,"\n    }"],[1,"\r"],[0,"\n  };"],[-1,"\n"],[1,"\r\n\r"],[0,"\n  // Ho"]],"start1":1143,"start2":1143,"length1":28,"length2":32},{"diffs":[[0,"ections."],[1,"\r"],[0,"\n  rtc.S"]],"start1":1218,"start2":1218,"length1":16,"length2":17},{"diffs":[[0,"302\"}]};"],[-1,"\n"],[1,"\r\n\r"],[0,"\n  // Re"]],"start1":1287,"start2":1287,"length1":17,"length2":19},{"diffs":[[0,"nstance."],[1,"\r"],[0,"\n  rtc.p"]],"start1":1343,"start2":1343,"length1":16,"length2":17},{"diffs":[[0,"ns = {};"],[-1,"\n"],[1,"\r\n\r"],[0,"\n  // Ar"]],"start1":1372,"start2":1372,"length1":17,"length2":19},{"diffs":[[0,"cket ids"],[1,"\r"],[0,"\n  rtc.c"]],"start1":1411,"start2":1411,"length1":16,"length2":17},{"diffs":[[0,"ns = [];"],[1,"\r"],[0,"\n  // St"]],"start1":1436,"start2":1436,"length1":16,"length2":17},{"diffs":[[0,"riables."],[1,"\r"],[0,"\n  rtc.s"]],"start1":1468,"start2":1468,"length1":16,"length2":17},{"diffs":[[0,"ms = [];"],[1,"\r"],[0,"\n  rtc.n"]],"start1":1489,"start2":1489,"length1":16,"length2":17},{"diffs":[[0,"ams = 0;"],[1,"\r"],[0,"\n  rtc.i"]],"start1":1512,"start2":1512,"length1":16,"length2":17},{"diffs":[[0,"= 0;"],[-1,"\n"],[1,"\r\n\r"],[0,"\n  /**"],[1,"\r"],[0,"\n   "]],"start1":1547,"start2":1547,"length1":15,"length2":18},{"diffs":[[0,"ver."],[1,"\r"],[0,"\n   */"],[1,"\r"],[0,"\n  r"]],"start1":1596,"start2":1596,"length1":14,"length2":16},{"diffs":[[0,"ver, room) {"],[1,"\r"],[0,"\n    room = "]],"start1":1637,"start2":1637,"length1":24,"length2":25},{"diffs":[[0,"k string"],[1,"\r"],[0,"\n    rtc"]],"start1":1716,"start2":1716,"length1":16,"length2":17},{"diffs":[[0,"server);"],[-1,"\n"],[1,"\r\n\r"],[0,"\n    rtc"]],"start1":1758,"start2":1758,"length1":17,"length2":19},{"diffs":[[0,"tion() {"],[-1,"\n"],[1,"\r\n\r"],[0,"\n      r"]],"start1":1799,"start2":1799,"length1":17,"length2":19},{"diffs":[[0,"JSON.stringify({"],[1,"\r"],[0,"\n        \"eventN"]],"start1":1834,"start2":1834,"length1":32,"length2":33},{"diffs":[[0,"n_room\","],[1,"\r"],[0,"\n       "]],"start1":1877,"start2":1877,"length1":16,"length2":17},{"diffs":[[0,"        \"data\":{"],[1,"\r"],[0,"\n          \"room"]],"start1":1887,"start2":1887,"length1":32,"length2":33},{"diffs":[[0,"m\": room"],[1,"\r"],[0,"\n       "]],"start1":1919,"start2":1919,"length1":16,"length2":17},{"diffs":[[0," room\r\n        }"],[1,"\r"],[0,"\n      }), funct"]],"start1":1922,"start2":1922,"length1":32,"length2":33},{"diffs":[[0,"function(error){"],[1,"\r"],[0,"\n          if(er"]],"start1":1950,"start2":1950,"length1":32,"length2":33},{"diffs":[[0,"ole.log(error);}"],[1,"\r"],[0,"\n        });\n\n  "]],"start1":1992,"start2":1992,"length1":32,"length2":33},{"diffs":[[0,");}\r\n        });"],[-1,"\n"],[1,"\r\n\r"],[0,"\n      rtc._sock"]],"start1":2005,"start2":2005,"length1":33,"length2":35},{"diffs":[[0,"n(msg) {"],[1,"\r"],[0,"\n       "]],"start1":2062,"start2":2062,"length1":16,"length2":17},{"diffs":[[0,"e(msg.data);"],[1,"\r"],[0,"\n        rtc"]],"start1":2100,"start2":2100,"length1":24,"length2":25},{"diffs":[[0," json.data);"],[1,"\r"],[0,"\n      };\n\n "]],"start1":2146,"start2":2146,"length1":24,"length2":25},{"diffs":[[0,"data);\r\n      };"],[-1,"\n"],[1,"\r\n\r"],[0,"\n      rtc._sock"]],"start1":2152,"start2":2152,"length1":33,"length2":35},{"diffs":[[0,"n(err) {"],[1,"\r"],[0,"\n       "]],"start1":2207,"start2":2207,"length1":16,"length2":17},{"diffs":[[0,"error');"],[1,"\r"],[0,"\n       "]],"start1":2240,"start2":2240,"length1":16,"length2":17},{"diffs":[[0,"og(err);"],[1,"\r"],[0,"\n      }"]],"start1":2267,"start2":2267,"length1":16,"length2":17},{"diffs":[[0,"(err);\r\n      };"],[-1,"\n"],[1,"\r\n\r"],[0,"\n      rtc._sock"]],"start1":2269,"start2":2269,"length1":33,"length2":35},{"diffs":[[0,"function(data) {"],[1,"\r"],[0,"\n        rtc.fir"]],"start1":2317,"start2":2317,"length1":32,"length2":33},{"diffs":[[0,"_socket.id);"],[1,"\r"],[0,"\n        del"]],"start1":2377,"start2":2377,"length1":24,"length2":25},{"diffs":[[0,"ket.id];"],[1,"\r"],[0,"\n      }"]],"start1":2434,"start2":2434,"length1":16,"length2":17},{"diffs":[[0,"];\r\n      };"],[-1,"\n"],[1,"\r\n\r"],[0,"\n      rtc.o"]],"start1":2440,"start2":2440,"length1":25,"length2":27},{"diffs":[[0,"function(data) {"],[1,"\r"],[0,"\n        rtc.con"]],"start1":2482,"start2":2482,"length1":32,"length2":33},{"diffs":[[0,"connections;"],[1,"\r\n        rtc._me = data.you;\r"],[0,"\n        // "]],"start1":2531,"start2":2531,"length1":24,"length2":54},{"diffs":[[0,"ss peers"],[1,"\r"],[0,"\n       "]],"start1":2614,"start2":2614,"length1":16,"length2":17},{"diffs":[[0,"ctions);"],[1,"\r"],[0,"\n      }"]],"start1":2665,"start2":2665,"length1":16,"length2":17},{"diffs":[[0,"ons);\r\n      });"],[-1,"\n"],[1,"\r\n\r"],[0,"\n      rtc.on('r"]],"start1":2668,"start2":2668,"length1":33,"length2":35},{"diffs":[[0,"tion(data) {"],[1,"\r"],[0,"\n    \tvar ca"]],"start1":2730,"start2":2730,"length1":24,"length2":25},{"diffs":[[0,"idate(data);"],[1,"\r"],[0,"\n    \trtc.pe"]],"start1":2779,"start2":2779,"length1":24,"length2":25},{"diffs":[[0,"(candidate);"],[1,"\r"],[0,"\n        rtc"]],"start1":2848,"start2":2848,"length1":24,"length2":25},{"diffs":[[0," candidate);"],[1,"\r"],[0,"\n      });\n\n"]],"start1":2903,"start2":2903,"length1":24,"length2":25},{"diffs":[[0,"ate);\r\n      });"],[-1,"\n"],[1,"\r\n\r"],[0,"\n      rtc.on('n"]],"start1":2910,"start2":2910,"length1":33,"length2":35},{"diffs":[[0,"function(data) {"],[1,"\r"],[0,"\n        rtc.con"]],"start1":2965,"start2":2965,"length1":32,"length2":33},{"diffs":[[0,"cketId);"],[-1,"\n"],[1,"\r\n\r"],[0,"\n       "]],"start1":3019,"start2":3019,"length1":17,"length2":19},{"diffs":[[0,"(data.socketId);"],[1,"\r"],[0,"\n        for (va"]],"start1":3072,"start2":3072,"length1":32,"length2":33},{"diffs":[[0,"ngth; i++) {"],[1,"\r"],[0,"\n          v"]],"start1":3132,"start2":3132,"length1":24,"length2":25},{"diffs":[[0,".streams[i];"],[1,"\r"],[0,"\n          p"]],"start1":3172,"start2":3172,"length1":24,"length2":25},{"diffs":[[0,"dStream(stream);"],[1,"\r"],[0,"\n        }\n     "]],"start1":3201,"start2":3201,"length1":32,"length2":33},{"diffs":[[0,"eam);\r\n        }"],[1,"\r"],[0,"\n      });\n\n    "]],"start1":3212,"start2":3212,"length1":32,"length2":33},{"diffs":[[0,"    }\r\n      });"],[-1,"\n"],[1,"\r\n\r"],[0,"\n      rtc.on('r"]],"start1":3223,"start2":3223,"length1":33,"length2":35},{"diffs":[[0,"ata) {  "],[1,"\r"],[0,"\n       "]],"start1":3291,"start2":3291,"length1":16,"length2":17},{"diffs":[[0,"a.socketId);"],[1,"\r"],[0,"\n        del"]],"start1":3342,"start2":3342,"length1":24,"length2":25},{"diffs":[[0,"a.socketId];"],[1,"\r"],[0,"\n      });\n\n"]],"start1":3394,"start2":3394,"length1":24,"length2":25},{"diffs":[[0,"tId];\r\n      });"],[-1,"\n"],[1,"\r\n\r"],[0,"\n      rtc.on('r"]],"start1":3401,"start2":3401,"length1":33,"length2":35},{"diffs":[[0,"function(data) {"],[1,"\r"],[0,"\n        rtc.rec"]],"start1":3451,"start2":3451,"length1":32,"length2":33},{"diffs":[[0,"etId, data.sdp);"],[1,"\r"],[0,"\n        rtc.fir"]],"start1":3503,"start2":3503,"length1":32,"length2":33},{"diffs":[[0,"e offer', data);"],[1,"\r"],[0,"\n      });\n\n    "]],"start1":3545,"start2":3545,"length1":32,"length2":33},{"diffs":[[0,"ata);\r\n      });"],[-1,"\n"],[1,"\r\n\r"],[0,"\n      rtc.on('r"]],"start1":3556,"start2":3556,"length1":33,"length2":35},{"diffs":[[0,"tion(data) {"],[1,"\r"],[0,"\n        rtc"]],"start1":3611,"start2":3611,"length1":24,"length2":25},{"diffs":[[0,"ta.sdp);"],[1,"\r"],[0,"\n       "]],"start1":3668,"start2":3668,"length1":16,"length2":17},{"diffs":[[0,"wer', data);"],[1,"\r"],[0,"\n      });\n\n"]],"start1":3707,"start2":3707,"length1":24,"length2":25},{"diffs":[[0,"     });"],[-1,"\n"],[1,"\r\n\r"],[0,"\n      r"]],"start1":3722,"start2":3722,"length1":17,"length2":19},{"diffs":[[0,"t');"],[1,"\r"],[0,"\n    };"],[1,"\r"],[0,"\n  };"],[-1,"\n\n"],[1,"\r\n\r\n\r"],[0,"\n  r"]],"start1":3756,"start2":3756,"length1":22,"length2":27},{"diffs":[[0,"s = function() {"],[1,"\r"],[0,"\n    for (var i "]],"start1":3795,"start2":3795,"length1":32,"length2":33},{"diffs":[[0," i < len; i++) {"],[1,"\r"],[0,"\n      var socke"]],"start1":3862,"start2":3862,"length1":32,"length2":33},{"diffs":[[0,"nections[i];"],[1,"\r"],[0,"\n      rtc.s"]],"start1":3908,"start2":3908,"length1":24,"length2":25},{"diffs":[[0,"cketId);"],[1,"\r"],[0,"\n    }"],[1,"\r"],[0,"\n  }"],[-1,"\n"],[1,"\r\n\r"],[0,"\n  rtc.o"]],"start1":3944,"start2":3944,"length1":27,"length2":31},{"diffs":[[0,"tion(data) {"],[1,"\r"],[0,"\n    rtc.on("]],"start1":3988,"start2":3988,"length1":24,"length2":25},{"diffs":[[0,"function() {"],[1,"\r"],[0,"\n      rtc.f"]],"start1":4029,"start2":4029,"length1":24,"length2":25},{"diffs":[[0,"ta);"],[1,"\r"],[0,"\n    });"],[1,"\r"],[0,"\n  }"],[-1,"\n"],[1,"\r\n\r"],[0,"\n  r"]],"start1":4076,"start2":4076,"length1":21,"length2":25},{"diffs":[[0,"s = function() {"],[1,"\r"],[0,"\n    for (var i "]],"start1":4124,"start2":4124,"length1":32,"length2":33},{"diffs":[[0,"ngth; i++) {"],[1,"\r"],[0,"\n      rtc.c"]],"start1":4184,"start2":4184,"length1":24,"length2":25},{"diffs":[[0,"ons[i]);"],[1,"\r"],[0,"\n    }"],[1,"\r"],[0,"\n  };"],[-1,"\n"],[1,"\r\n\r"],[0,"\n  rtc.c"]],"start1":4241,"start2":4241,"length1":28,"length2":32},{"diffs":[[0,"nction(id) {"],[1,"\r"],[0,"\n    console"]],"start1":4297,"start2":4297,"length1":24,"length2":25},{"diffs":[[0,"ction');"],[1,"\r"],[0,"\n    var"]],"start1":4343,"start2":4343,"length1":16,"length2":17},{"diffs":[[0,"SERVER);"],[1,"\r"],[0,"\n    pc."]],"start1":4415,"start2":4415,"length1":16,"length2":17},{"diffs":[[0,"ion(event) {"],[1,"\r"],[0,"\n      if (e"]],"start1":4454,"start2":4454,"length1":24,"length2":25},{"diffs":[[0,"idate) {"],[1,"\r"],[0,"\n       "]],"start1":4488,"start2":4488,"length1":16,"length2":17},{"diffs":[[0,"JSON.stringify({"],[1,"\r"],[0,"\n           \"eve"]],"start1":4524,"start2":4524,"length1":32,"length2":33},{"diffs":[[0,"didate\","],[1,"\r"],[0,"\n       "]],"start1":4579,"start2":4579,"length1":16,"length2":17},{"diffs":[[0,"data\": {"],[1,"\r"],[0,"\n       "]],"start1":4601,"start2":4601,"length1":16,"length2":17},{"diffs":[[0,"e.label,"],[1,"\r"],[0,"\n       "]],"start1":4648,"start2":4648,"length1":16,"length2":17},{"diffs":[[0,"ndidate,"],[1,"\r"],[0,"\n       "]],"start1":4703,"start2":4703,"length1":16,"length2":17},{"diffs":[[0,"tId\": id"],[1,"\r"],[0,"\n       "]],"start1":4733,"start2":4733,"length1":16,"length2":17},{"diffs":[[0,"id\r\n           }"],[1,"\r"],[0,"\n         }), fu"]],"start1":4739,"start2":4739,"length1":32,"length2":33},{"diffs":[[0,"function(error){"],[1,"\r"],[0,"\n           if(e"]],"start1":4770,"start2":4770,"length1":32,"length2":33},{"diffs":[[0,"error);}"],[1,"\r"],[0,"\n       "]],"start1":4821,"start2":4821,"length1":16,"length2":17},{"diffs":[[0,"         });"],[1,"\r"],[0,"\n       }\n  "]],"start1":4831,"start2":4831,"length1":24,"length2":25},{"diffs":[[0,"   });\r\n       }"],[1,"\r"],[0,"\n       rtc.fire"]],"start1":4837,"start2":4837,"length1":32,"length2":33},{"diffs":[[0,"te);"],[1,"\r"],[0,"\n     };"],[-1,"\n"],[1,"\r\n\r"],[0,"\n   "]],"start1":4901,"start2":4901,"length1":17,"length2":20},{"diffs":[[0,"function() {"],[1,"\r"],[0,"\n      // TO"]],"start1":4934,"start2":4934,"length1":24,"length2":25},{"diffs":[[0,"inalize this API"],[1,"\r"],[0,"\n      rtc.fire("]],"start1":4964,"start2":4964,"length1":32,"length2":33},{"diffs":[[0,"pened');"],[1,"\r"],[0,"\n    };"],[-1,"\n"],[1,"\r\n\r"],[0,"\n    pc."]],"start1":5015,"start2":5015,"length1":24,"length2":27},{"diffs":[[0,"event) {"],[1,"\r"],[0,"\n      /"]],"start1":5065,"start2":5065,"length1":16,"length2":17},{"diffs":[[0,"this API"],[1,"\r"],[0,"\n      r"]],"start1":5099,"start2":5099,"length1":16,"length2":17},{"diffs":[[0,"am, id);"],[1,"\r"],[0,"\n    };"],[1,"\r"],[0,"\n    ret"]],"start1":5155,"start2":5155,"length1":23,"length2":25},{"diffs":[[0,"turn pc;"],[1,"\r"],[0,"\n  };"],[-1,"\n"],[1,"\r\n\r"],[0,"\n  rtc.s"]],"start1":5179,"start2":5179,"length1":22,"length2":25},{"diffs":[[0,"tion(socketId) {"],[1,"\r"],[0,"\n    var pc = rt"]],"start1":5219,"start2":5219,"length1":32,"length2":33},{"diffs":[[0,"tions[socketId];"],[1,"\r"],[0,"\n    pc.createOf"]],"start1":5264,"start2":5264,"length1":32,"length2":33},{"diffs":[[0,"n_description) {"],[1,"\r"],[0,"\n    pc.setLocal"]],"start1":5317,"start2":5317,"length1":32,"length2":33},{"diffs":[[0,"on_description);"],[1,"\r"],[0,"\n    rtc._socket"]],"start1":5367,"start2":5367,"length1":32,"length2":33},{"diffs":[[0,"JSON.stringify({"],[1,"\r"],[0,"\n        \"eventN"]],"start1":5406,"start2":5406,"length1":32,"length2":33},{"diffs":[[0,"send_offer\","],[1,"\r"],[0,"\n        \"da"]],"start1":5446,"start2":5446,"length1":24,"length2":25},{"diffs":[[0,"        \"data\":{"],[1,"\r"],[0,"\n            \"so"]],"start1":5460,"start2":5460,"length1":32,"length2":33},{"diffs":[[0,"etId\": socketId,"],[1,"\r"],[0,"\n            \"sd"]],"start1":5495,"start2":5495,"length1":32,"length2":33},{"diffs":[[0,"sion_description"],[1,"\r"],[0,"\n            }\n "]],"start1":5535,"start2":5535,"length1":32,"length2":33},{"diffs":[[0,"n\r\n            }"],[1,"\r"],[0,"\n        }), fun"]],"start1":5550,"start2":5550,"length1":32,"length2":33},{"diffs":[[0,"function(error){"],[1,"\r"],[0,"\n            if("]],"start1":5580,"start2":5580,"length1":32,"length2":33},{"diffs":[[0,"sole.log(error);"],[1,"\r"],[0,"\n        }\n   })"]],"start1":5623,"start2":5623,"length1":32,"length2":33},{"diffs":[[0,"   }"],[1,"\r"],[0,"\n   });"],[1,"\r"],[0,"\n    });"],[1,"\r"],[0,"\n  };"],[-1,"\n\n"],[1,"\r\n\r\n\r"],[0,"\n  r"]],"start1":5646,"start2":5646,"length1":30,"length2":36},{"diffs":[[0,"socketId, sdp) {"],[1,"\r"],[0,"\n    var pc = rt"]],"start1":5709,"start2":5709,"length1":32,"length2":33},{"diffs":[[0,"tions[socketId];"],[1,"\r"],[0,"\n    pc.setRemot"]],"start1":5754,"start2":5754,"length1":32,"length2":33},{"diffs":[[0,"n(sdp));"],[1,"\r"],[0,"\n    rtc"]],"start1":5824,"start2":5824,"length1":16,"length2":17},{"diffs":[[0,"cketId);"],[1,"\r"],[0,"\n  };"],[-1,"\n\n"],[1,"\r\n\r\n\r"],[0,"\n  rtc.s"]],"start1":5855,"start2":5855,"length1":23,"length2":27},{"diffs":[[0,"(socketId) {"],[1,"\r"],[0,"\n    var pc "]],"start1":5902,"start2":5902,"length1":24,"length2":25},{"diffs":[[0,"tions[socketId];"],[1,"\r"],[0,"\n    pc.createAn"]],"start1":5943,"start2":5943,"length1":32,"length2":33},{"diffs":[[0,"ption) {"],[1,"\r"],[0,"\n    pc."]],"start1":6005,"start2":6005,"length1":16,"length2":17},{"diffs":[[0,"iption);"],[1,"\r"],[0,"\n    rtc"]],"start1":6055,"start2":6055,"length1":16,"length2":17},{"diffs":[[0,"ingify({"],[1,"\r"],[0,"\n       "]],"start1":6094,"start2":6094,"length1":16,"length2":17},{"diffs":[[0,"answer\","],[1,"\r"],[0,"\n       "]],"start1":6131,"start2":6131,"length1":16,"length2":17},{"diffs":[[0,"\"data\":{"],[1,"\r"],[0,"\n       "]],"start1":6149,"start2":6149,"length1":16,"length2":17},{"diffs":[[0,"ocketId,"],[1,"\r"],[0,"\n       "]],"start1":6184,"start2":6184,"length1":16,"length2":17},{"diffs":[[0,"cription"],[1,"\r"],[0,"\n       "]],"start1":6224,"start2":6224,"length1":16,"length2":17},{"diffs":[[0,"           }"],[1,"\r"],[0,"\n        }),"]],"start1":6235,"start2":6235,"length1":24,"length2":25},{"diffs":[[0,"(error){"],[1,"\r"],[0,"\n       "]],"start1":6269,"start2":6269,"length1":16,"length2":17},{"diffs":[[0,"(error);"],[1,"\r"],[0,"\n       "]],"start1":6312,"start2":6312,"length1":16,"length2":17},{"diffs":[[0,"       }"],[1,"\r"],[0,"\n   });"],[1,"\r"],[0,"\n    var"]],"start1":6323,"start2":6323,"length1":23,"length2":25},{"diffs":[[0,"ion;"],[1,"\r"],[0,"\n    });"],[1,"\r"],[0,"\n  };"],[-1,"\n\n"],[1,"\r\n\r\n\r"],[0,"\n  r"]],"start1":6374,"start2":6374,"length1":23,"length2":28},{"diffs":[[0,", sdp) {"],[1,"\r"],[0,"\n    var"]],"start1":6438,"start2":6438,"length1":16,"length2":17},{"diffs":[[0,"cketId];"],[1,"\r"],[0,"\n    pc."]],"start1":6483,"start2":6483,"length1":16,"length2":17},{"diffs":[[0,"n(sdp));"],[1,"\r"],[0,"\n  };"],[-1,"\n\n"],[1,"\r\n\r\n\r"],[0,"\n  rtc.c"]],"start1":6545,"start2":6545,"length1":23,"length2":27},{"diffs":[[0,"nFail) {"],[1,"\r"],[0,"\n    var"]],"start1":6612,"start2":6612,"length1":16,"length2":17},{"diffs":[[0,"options;"],[1,"\r"],[0,"\n    onS"]],"start1":6630,"start2":6630,"length1":16,"length2":17},{"diffs":[[0,"ccess ||"],[1,"\r"],[0,"\n    fun"]],"start1":6660,"start2":6660,"length1":16,"length2":17},{"diffs":[[0,"on() {};"],[1,"\r"],[0,"\n    onF"]],"start1":6680,"start2":6680,"length1":16,"length2":17},{"diffs":[[0,"nFail ||"],[1,"\r"],[0,"\n    fun"]],"start1":6704,"start2":6704,"length1":16,"length2":17},{"diffs":[[0,"on() {};"],[-1,"\n"],[1,"\r\n\r"],[0,"\n    if("]],"start1":6724,"start2":6724,"length1":17,"length2":19},{"diffs":[[0,"o && opt.video){"],[1,"\r"],[0,"\n      options ="]],"start1":6751,"start2":6751,"length1":32,"length2":33},{"diffs":[[0,"     options = {"],[1,"\r"],[0,"\n        video: "]],"start1":6770,"start2":6770,"length1":32,"length2":33},{"diffs":[[0,"    video: true,"],[1,"\r"],[0,"\n        audio: "]],"start1":6792,"start2":6792,"length1":32,"length2":33},{"diffs":[[0,"     audio: true"],[1,"\r"],[0,"\n      };\n    }e"]],"start1":6813,"start2":6813,"length1":32,"length2":33},{"diffs":[[0,": true\r\n      };"],[1,"\r"],[0,"\n    }else if(op"]],"start1":6823,"start2":6823,"length1":32,"length2":33},{"diffs":[[0,".video){"],[1,"\r"],[0,"\n      o"]],"start1":6857,"start2":6857,"length1":16,"length2":17},{"diffs":[[0,"     options = {"],[1,"\r"],[0,"\n        video: "]],"start1":6868,"start2":6868,"length1":32,"length2":33},{"diffs":[[0,"o: true,"],[1,"\r"],[0,"\n       "]],"start1":6898,"start2":6898,"length1":16,"length2":17},{"diffs":[[0,"    audio: false"],[1,"\r"],[0,"\n      };\n    }e"]],"start1":6912,"start2":6912,"length1":32,"length2":33},{"diffs":[[0," false\r\n      };"],[1,"\r"],[0,"\n    }else if(op"]],"start1":6922,"start2":6922,"length1":32,"length2":33},{"diffs":[[0,".audio){"],[1,"\r"],[0,"\n      o"]],"start1":6956,"start2":6956,"length1":16,"length2":17},{"diffs":[[0,"     options = {"],[1,"\r"],[0,"\n        video: "]],"start1":6967,"start2":6967,"length1":32,"length2":33},{"diffs":[[0,"   video: false,"],[1,"\r"],[0,"\n        audio: "]],"start1":6990,"start2":6990,"length1":32,"length2":33},{"diffs":[[0,"io: true"],[1,"\r"],[0,"\n      }"]],"start1":7019,"start2":7019,"length1":16,"length2":17},{"diffs":[[0,"ue\r\n      };"],[1,"\r"],[0,"\n    }else {"]],"start1":7025,"start2":7025,"length1":24,"length2":25},{"diffs":[[0,"\n    }else {"],[1,"\r"],[0,"\n      optio"]],"start1":7038,"start2":7038,"length1":24,"length2":25},{"diffs":[[0,"ions = {"],[1,"\r"],[0,"\n       "]],"start1":7061,"start2":7061,"length1":16,"length2":17},{"diffs":[[0,": false,"],[1,"\r"],[0,"\n       "]],"start1":7084,"start2":7084,"length1":16,"length2":17},{"diffs":[[0,"o: false"],[1,"\r"],[0,"\n      }"]],"start1":7106,"start2":7106,"length1":16,"length2":17},{"diffs":[[0,"      };"],[1,"\r"],[0,"\n    }"],[-1,"\n"],[1,"\r\n\r"],[0,"\n    if "]],"start1":7116,"start2":7116,"length1":23,"length2":26},{"diffs":[[0,"Media) {"],[1,"\r"],[0,"\n      r"]],"start1":7150,"start2":7150,"length1":16,"length2":17},{"diffs":[[0,"umStreams++;"],[1,"\r"],[0,"\n      getUs"]],"start1":7171,"start2":7171,"length1":24,"length2":25},{"diffs":[[0,"tream) {"],[1,"\r"],[0,"\n       "]],"start1":7239,"start2":7239,"length1":16,"length2":17},{"diffs":[[0,"        "],[1,"\r"],[0,"\n       "]],"start1":7249,"start2":7249,"length1":16,"length2":17},{"diffs":[[0,"ms.push(stream);"],[1,"\r"],[0,"\n        rtc.ini"]],"start1":7276,"start2":7276,"length1":32,"length2":33},{"diffs":[[0,"reams++;"],[1,"\r"],[0,"\n       "]],"start1":7319,"start2":7319,"length1":16,"length2":17},{"diffs":[[0,"ess(stream);"],[1,"\r"],[0,"\n        if "]],"start1":7343,"start2":7343,"length1":24,"length2":25},{"diffs":[[0,"umStreams) {"],[1,"\r"],[0,"\n          r"]],"start1":7401,"start2":7401,"length1":24,"length2":25},{"diffs":[[0,"ready');"],[1,"\r"],[0,"\n       "]],"start1":7435,"start2":7435,"length1":16,"length2":17},{"diffs":[[0,";\r\n        }"],[1,"\r"],[0,"\n      }, fu"]],"start1":7442,"start2":7442,"length1":24,"length2":25},{"diffs":[[0,"function() {"],[1,"\r"],[0,"\n        ale"]],"start1":7465,"start2":7465,"length1":24,"length2":25},{"diffs":[[0,"ream.\");"],[1,"\r"],[0,"\n       "]],"start1":7514,"start2":7514,"length1":16,"length2":17},{"diffs":[[0,"nFail();"],[1,"\r"],[0,"\n      }"]],"start1":7533,"start2":7533,"length1":16,"length2":17},{"diffs":[[0,"     });"],[1,"\r"],[0,"\n    } e"]],"start1":7544,"start2":7544,"length1":16,"length2":17},{"diffs":[[0,"} else {"],[1,"\r"],[0,"\n      a"]],"start1":7558,"start2":7558,"length1":16,"length2":17},{"diffs":[[0,".');"],[1,"\r"],[0,"\n    }"],[1,"\r"],[0,"\n  }"],[-1,"\n\n"],[1,"\r\n\r\n\r"],[0,"\n  r"]],"start1":7624,"start2":7624,"length1":20,"length2":25},{"diffs":[[0,"function() {"],[1,"\r"],[0,"\n    for (va"]],"start1":7665,"start2":7665,"length1":24,"length2":25},{"diffs":[[0,"; i++) {"],[1,"\r"],[0,"\n      v"]],"start1":7721,"start2":7721,"length1":16,"length2":17},{"diffs":[[0,"eams[i];"],[1,"\r"],[0,"\n      f"]],"start1":7757,"start2":7757,"length1":16,"length2":17},{"diffs":[[0,"tions) {"],[1,"\r"],[0,"\n       "]],"start1":7810,"start2":7810,"length1":16,"length2":17},{"diffs":[[0,"am);"],[1,"\r"],[0,"\n      }"],[1,"\r"],[0,"\n    }"],[1,"\r"],[0,"\n  };"],[-1,"\n\n"],[1,"\r\n\r\n\r"],[0,"\n  r"]],"start1":7874,"start2":7874,"length1":29,"length2":35},{"diffs":[[0,"domId) {"],[1,"\r"],[0,"\n    doc"]],"start1":7944,"start2":7944,"length1":16,"length2":17},{"diffs":[[0,"am);"],[1,"\r"],[0,"\n  };"],[-1,"\n"],[1,"\r\n\r"],[0,"\n  r"]],"start1":8019,"start2":8019,"length1":14,"length2":17},{"diffs":[[0,"tion() {"],[1,"\r"],[0,"\n    rtc"]],"start1":8055,"start2":8055,"length1":16,"length2":17},{"diffs":[[0,"nnections();"],[1,"\r"],[0,"\n    rtc.add"]],"start1":8085,"start2":8085,"length1":24,"length2":25},{"diffs":[[0,"reams();"],[1,"\r"],[0,"\n    rtc"]],"start1":8112,"start2":8112,"length1":16,"length2":17},{"diffs":[[0,"s();"],[1,"\r"],[0,"\n  });"],[-1,"\n"],[1,"\r\n\r"],[0,"\n})."]],"start1":8139,"start2":8139,"length1":15,"length2":18},{"diffs":[[0,"l(this);"],[-1,"\n"]],"start1":8160,"start2":8160,"length1":9,"length2":8}]],"length":8168,"saved":false}
{"contributors":[],"silentsave":false,"ts":1354653092348,"patch":[[{"diffs":[[0,"ream, id"],[1,", rtc._me"],[0,");\r\n    "]],"start1":5153,"start2":5153,"length1":16,"length2":25}]],"length":8177,"saved":false}
{"ts":1354654871301,"patch":[[{"diffs":[[0,", id"],[-1,", rtc._me"],[0,");\r\n"]],"start1":5157,"start2":5157,"length1":17,"length2":8}]],"length":8168,"saved":false}
{"contributors":[],"silentsave":true,"ts":1354722885937,"patch":[[{"diffs":[[0," typeof "],[-1,"module"],[1,"gi"],[0,") {\r\n   "]],"start1":430,"start2":430,"length1":22,"length2":18}]],"length":8164,"saved":false}
{"ts":1354722887263,"patch":[[{"diffs":[[0," typeof "],[-1,"gi"],[0,") {\r\n   "]],"start1":430,"start2":430,"length1":18,"length2":16}]],"length":8162,"saved":false}
{"contributors":[],"silentsave":true,"ts":1354727971328,"patch":[[{"diffs":[[0," typeof "],[1,"module"],[0,") {\r\n   "]],"start1":430,"start2":430,"length1":16,"length2":22},{"diffs":[[0," {\r\n    "],[-1,"\t"],[1,"    "],[0,"var cand"]],"start1":2740,"start2":2740,"length1":17,"length2":20},{"diffs":[[0,"    "],[-1,"\t"],[1,"    "],[0,"rtc."]],"start1":2796,"start2":2796,"length1":9,"length2":12}]],"length":8174,"saved":false}
