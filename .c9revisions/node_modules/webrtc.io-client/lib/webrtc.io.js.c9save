{"ts":1354727529953,"silentsave":true,"restoring":false,"patch":[[{"diffs":[[1,"//CLIENT\n\n // Fallbacks for vendor-specific variables until the spec is finalized.\n\t\nvar PeerConnection = window.PeerConnection || window.webkitPeerConnection00 || window.webkitRTCPeerConnection;\nvar URL = window.URL || window.webkitURL || window.msURL || window.oURL;\nvar getUserMedia = navigator.getUserMedia || navigator.webkitGetUserMedia || navigator.mozGetUserMedia || navigator.msGetUserMedia;\n\n(function() {\n\n  var rtc;\n  if ('undefined' === typeof module) {\n    rtc = this.rtc = {};\n  } else {\n    rtc = module.exports = {};\n  }\n\n \n  // Holds a connection to the server.\n  rtc._socket = null;\n\n  // Holds callbacks for certain events.\n  rtc._events = {};\n\n  rtc.on = function(eventName, callback) {\n    rtc._events[eventName] = rtc._events[eventName] || [];\n    rtc._events[eventName].push(callback);\n  };\n\n  rtc.fire = function(eventName, _) {\n    var events = rtc._events[eventName];\n    var args = Array.prototype.slice.call(arguments, 1);\n\n    if (!events) {\n      return;\n    }\n\n    for (var i = 0, len = events.length; i < len; i++) {\n      events[i].apply(null, args);\n    }\n  };\n\n  // Holds the STUN/ICE server to use for PeerConnections.\n  rtc.SERVER = {iceServers:[{url:\"stun:stun.l.google.com:19302\"}]};\n\n  // Referenc e to the lone PeerConnection instance.\n  rtc.peerConnections = {};\n\n  // Array of known peer socket ids\n  rtc.connections = [];\n  // Stream-related variables.\n  rtc.streams = [];\n  rtc.numStreams = 0;\n  rtc.initializedStreams = 0;\n\n  /**\n   * Connects to the websocket server.\n   */\n  rtc.connect = function(server, room) {\n    room = room || \"\"; // by default, join a room called the blank string\n    rtc._socket = new WebSocket(server);\n\n    rtc._socket.onopen = function() {\n\n      rtc._socket.send(JSON.stringify({\n        \"eventName\": \"join_room\",\n        \"data\":{\n          \"room\": room\n        }\n      }), function(error){\n          if(error){console.log(error);}\n        });\n\n      rtc._socket.onmessage = function(msg) {\n        var json = JSON.parse(msg.data);\n        rtc.fire(json.eventName, json.data);\n      };\n\n      rtc._socket.onerror = function(err) {\n        console.log('onerror');\n        console.log(err);\n      };\n\n      rtc._socket.onclose = function(data) {\n        rtc.fire('disconnect stream', rtc._socket.id);\n        delete rtc.peerConnections[rtc._socket.id];\n      };\n\n      rtc.on('get_peers', function(data) {\n        rtc.connections = data.connections;\n        // fire connections event and pass peers\n        rtc.fire('connections', rtc.connections);\n      });\n\n      rtc.on('receive_ice_candidate', function(data) {\n    \tvar candidate = new RTCIceCandidate(data);\n    \trtc.peerConnections[data.socketId].addIceCandidate(candidate);\n        rtc.fire('receive ice candidate', candidate);\n      });\n\n      rtc.on('new_peer_connected', function(data) {\n        rtc.connections.push(data.socketId);\n\n        var pc = rtc.createPeerConnection(data.socketId);\n        for (var i = 0; i < rtc.streams.length; i++) {\n          var stream = rtc.streams[i];\n          pc.addStream(stream);\n        }\n      });\n\n      rtc.on('remove_peer_connected', function(data) {  \n        rtc.fire('disconnect stream', data.socketId);\n        delete rtc.peerConnections[data.socketId];\n      });\n\n      rtc.on('receive_offer', function(data) {\n        rtc.receiveOffer(data.socketId, data.sdp);\n        rtc.fire('receive offer', data);\n      });\n\n      rtc.on('receive_answer', function(data) {\n        rtc.receiveAnswer(data.socketId, data.sdp);\n        rtc.fire('receive answer', data);\n      });\n\n      rtc.fire('connect');\n    };\n  };\n\n\n  rtc.sendOffers = function() {\n    for (var i = 0, len = rtc.connections.length; i < len; i++) {\n      var socketId = rtc.connections[i];\n      rtc.sendOffer(socketId);\n    }\n  }\n\n  rtc.onClose = function(data) {\n    rtc.on('close_stream', function() {\n      rtc.fire('close_stream', data);\n    });\n  }\n\n  rtc.createPeerConnections = function() {\n    for (var i = 0; i < rtc.connections.length; i++) {\n      rtc.createPeerConnection(rtc.connections[i]);\n    }\n  };\n\n  rtc.createPeerConnection = function(id) {\n    console.log('createPeerConnection');\n    var pc = rtc.peerConnections[id] = new PeerConnection(rtc.SERVER);\n    pc.onicecandidate = function(event) {\n      if (event.candidate) {\n         rtc._socket.send(JSON.stringify({\n           \"eventName\": \"send_ice_candidate\",\n           \"data\": {\n              \"label\": event.candidate.label,\n              \"candidate\": event.candidate.candidate,\n              \"socketId\": id\n           }\n         }), function(error){\n           if(error){console.log(error);}\n         });\n       }\n       rtc.fire('ice candidate', event.candidate);\n     };\n\n    pc.onopen = function() {\n      // TODO: Finalize this API\n      rtc.fire('peer connection opened');\n    };\n\n    pc.onaddstream = function(event) {\n      // TODO: Finalize this API\n      rtc.fire('add remote stream', event.stream, id);\n    };\n    return pc;\n  };\n\n  rtc.sendOffer = function(socketId) {\n    var pc = rtc.peerConnections[socketId];\n    pc.createOffer( function(session_description) {\n    pc.setLocalDescription(session_description);\n    rtc._socket.send(JSON.stringify({\n        \"eventName\": \"send_offer\",\n        \"data\":{\n            \"socketId\": socketId,\n            \"sdp\": session_description\n            }\n        }), function(error){\n            if(error){console.log(error);\n        }\n   });\n    });\n  };\n\n\n  rtc.receiveOffer = function(socketId, sdp) {\n    var pc = rtc.peerConnections[socketId];\n    pc.setRemoteDescription(new RTCSessionDescription(sdp));\n    rtc.sendAnswer(socketId);\n  };\n\n\n  rtc.sendAnswer = function(socketId) {\n    var pc = rtc.peerConnections[socketId];\n    pc.createAnswer( function(session_description) {\n    pc.setLocalDescription(session_description);\n    rtc._socket.send(JSON.stringify({\n        \"eventName\": \"send_answer\",\n        \"data\":{\n            \"socketId\": socketId,\n            \"sdp\": session_description\n            }\n        }), function(error){\n            if(error){console.log(error);\n        }\n   });\n    var offer = pc.remoteDescription;\n    });\n  };\n\n\n  rtc.receiveAnswer = function(socketId, sdp) {\n    var pc = rtc.peerConnections[socketId];\n    pc.setRemoteDescription(new RTCSessionDescription(sdp));\n  };\n\n\n  rtc.createStream = function(opt, onSuccess, onFail) {\n    var options;\n    onSuccess = onSuccess ||\n    function() {};\n    onFail = onFail ||\n    function() {};\n\n    if(opt.audio && opt.video){\n      options = {\n        video: true,\n        audio: true\n      };\n    }else if(opt.video){\n      options = {\n        video: true,\n        audio: false\n      };\n    }else if(opt.audio){\n      options = {\n        video: false,\n        audio: true\n      };\n    }else {\n      options = {\n        video: false,\n        audio: false\n      };\n    }\n\n    if (getUserMedia) {\n      rtc.numStreams++;\n      getUserMedia.call(navigator, options, function(stream) {\n        \n        rtc.streams.push(stream);\n        rtc.initializedStreams++;\n        onSuccess(stream);\n        if (rtc.initializedStreams === rtc.numStreams) {\n          rtc.fire('ready');\n        }\n      }, function() {\n        alert(\"Could not connect stream.\");\n        onFail();\n      });\n    } else {\n      alert('webRTC is not yet supported in this browser.');\n    }\n  }\n\n\n  rtc.addStreams = function() {\n    for (var i = 0; i < rtc.streams.length; i++) {\n      var stream = rtc.streams[i];\n      for (var connection in rtc.peerConnections) {\n        rtc.peerConnections[connection].addStream(stream);\n      }\n    }\n  };\n\n\n  rtc.attachStream = function(stream, domId) {\n    document.getElementById(domId).src = URL.createObjectURL(stream);\n  };\n\n  rtc.on('ready', function() {\n    rtc.createPeerConnections();\n    rtc.addStreams();\n    rtc.sendOffers();\n  });\n\n}).call(this);\n"]],"start1":0,"start2":0,"length1":0,"length2":7812}]],"length":7812}
{"contributors":[],"silentsave":true,"ts":1354727533764,"patch":[[{"diffs":[[0,"//CLIENT"],[-1,"\n"],[1,"\r\n\r"],[0,"\n // Fal"]],"start1":0,"start2":0,"length1":17,"length2":19},{"diffs":[[0,"zed."],[1,"\r"],[0,"\n\t"],[1,"\r"],[0,"\nvar"]],"start1":80,"start2":80,"length1":10,"length2":12},{"diffs":[[0,"nection;"],[1,"\r"],[0,"\nvar URL"]],"start1":191,"start2":191,"length1":16,"length2":17},{"diffs":[[0,"ow.oURL;"],[1,"\r"],[0,"\nvar get"]],"start1":265,"start2":265,"length1":16,"length2":17},{"diffs":[[0,"erMedia;"],[-1,"\n"],[1,"\r\n\r"],[0,"\n(functi"]],"start1":398,"start2":398,"length1":17,"length2":19},{"diffs":[[0,"tion() {"],[-1,"\n"],[1,"\r\n\r"],[0,"\n  var r"]],"start1":415,"start2":415,"length1":17,"length2":19},{"diffs":[[0,"var rtc;"],[1,"\r"],[0,"\n  if ('"]],"start1":429,"start2":429,"length1":16,"length2":17},{"diffs":[[0,"of module) {"],[1,"\r"],[0,"\n    rtc = t"]],"start1":465,"start2":465,"length1":24,"length2":25},{"diffs":[[0,"is.rtc = {};"],[1,"\r"],[0,"\n  } else {\n"]],"start1":491,"start2":491,"length1":24,"length2":25},{"diffs":[[0,"\r\n  } else {"],[1,"\r"],[0,"\n    rtc = m"]],"start1":503,"start2":503,"length1":24,"length2":25},{"diffs":[[0,"ts = {};"],[1,"\r"],[0,"\n  }"],[-1,"\n"],[1,"\r\n\r"],[0,"\n "],[1,"\r"],[0,"\n  // Ho"]],"start1":539,"start2":539,"length1":23,"length2":27},{"diffs":[[0," server."],[1,"\r"],[0,"\n  rtc._"]],"start1":589,"start2":589,"length1":16,"length2":17},{"diffs":[[0," = null;"],[-1,"\n"],[1,"\r\n\r"],[0,"\n  // Ho"]],"start1":612,"start2":612,"length1":17,"length2":19},{"diffs":[[0," events."],[1,"\r"],[0,"\n  rtc._"]],"start1":656,"start2":656,"length1":16,"length2":17},{"diffs":[[0,"ts = {};"],[-1,"\n"],[1,"\r\n\r"],[0,"\n  rtc.o"]],"start1":677,"start2":677,"length1":17,"length2":19},{"diffs":[[0,"lback) {"],[1,"\r"],[0,"\n    rtc"]],"start1":723,"start2":723,"length1":16,"length2":17},{"diffs":[[0,"] || [];"],[1,"\r"],[0,"\n    rtc"]],"start1":783,"start2":783,"length1":16,"length2":17},{"diffs":[[0,"llback);"],[1,"\r"],[0,"\n  };"],[-1,"\n"],[1,"\r\n\r"],[0,"\n  rtc.f"]],"start1":827,"start2":827,"length1":22,"length2":25},{"diffs":[[0,"me, _) {"],[1,"\r"],[0,"\n    var"]],"start1":874,"start2":874,"length1":16,"length2":17},{"diffs":[[0,"ntName];"],[1,"\r"],[0,"\n    var"]],"start1":916,"start2":916,"length1":16,"length2":17},{"diffs":[[0,"nts, 1);"],[-1,"\n"],[1,"\r\n\r"],[0,"\n    if "]],"start1":974,"start2":974,"length1":17,"length2":19},{"diffs":[[0," (!events) {"],[1,"\r"],[0,"\n      retur"]],"start1":992,"start2":992,"length1":24,"length2":25},{"diffs":[[0," return;"],[1,"\r"],[0,"\n    }"],[-1,"\n"],[1,"\r\n\r"],[0,"\n    for"]],"start1":1011,"start2":1011,"length1":23,"length2":26},{"diffs":[[0," len; i++) {"],[1,"\r"],[0,"\n      event"]],"start1":1074,"start2":1074,"length1":24,"length2":25},{"diffs":[[0,", args);"],[1,"\r"],[0,"\n    }"],[1,"\r"],[0,"\n  };"],[-1,"\n"],[1,"\r\n\r"],[0,"\n  // Ho"]],"start1":1114,"start2":1114,"length1":28,"length2":32},{"diffs":[[0,"ections."],[1,"\r"],[0,"\n  rtc.S"]],"start1":1189,"start2":1189,"length1":16,"length2":17},{"diffs":[[0,"302\"}]};"],[-1,"\n"],[1,"\r\n\r"],[0,"\n  // Re"]],"start1":1258,"start2":1258,"length1":17,"length2":19},{"diffs":[[0,"nstance."],[1,"\r"],[0,"\n  rtc.p"]],"start1":1314,"start2":1314,"length1":16,"length2":17},{"diffs":[[0,"ns = {};"],[-1,"\n"],[1,"\r\n\r"],[0,"\n  // Ar"]],"start1":1343,"start2":1343,"length1":17,"length2":19},{"diffs":[[0,"cket ids"],[1,"\r"],[0,"\n  rtc.c"]],"start1":1382,"start2":1382,"length1":16,"length2":17},{"diffs":[[0,"ns = [];"],[1,"\r"],[0,"\n  // St"]],"start1":1407,"start2":1407,"length1":16,"length2":17},{"diffs":[[0,"riables."],[1,"\r"],[0,"\n  rtc.s"]],"start1":1439,"start2":1439,"length1":16,"length2":17},{"diffs":[[0,"ms = [];"],[1,"\r"],[0,"\n  rtc.n"]],"start1":1460,"start2":1460,"length1":16,"length2":17},{"diffs":[[0,"ams = 0;"],[1,"\r"],[0,"\n  rtc.i"]],"start1":1483,"start2":1483,"length1":16,"length2":17},{"diffs":[[0,"= 0;"],[-1,"\n"],[1,"\r\n\r"],[0,"\n  /**"],[1,"\r"],[0,"\n   "]],"start1":1518,"start2":1518,"length1":15,"length2":18},{"diffs":[[0,"ver."],[1,"\r"],[0,"\n   */"],[1,"\r"],[0,"\n  r"]],"start1":1567,"start2":1567,"length1":14,"length2":16},{"diffs":[[0,"ver, room) {"],[1,"\r"],[0,"\n    room = "]],"start1":1608,"start2":1608,"length1":24,"length2":25},{"diffs":[[0,"k string"],[1,"\r"],[0,"\n    rtc"]],"start1":1687,"start2":1687,"length1":16,"length2":17},{"diffs":[[0,"server);"],[-1,"\n"],[1,"\r\n\r"],[0,"\n    rtc"]],"start1":1729,"start2":1729,"length1":17,"length2":19},{"diffs":[[0,"tion() {"],[-1,"\n"],[1,"\r\n\r"],[0,"\n      r"]],"start1":1770,"start2":1770,"length1":17,"length2":19},{"diffs":[[0,"JSON.stringify({"],[1,"\r"],[0,"\n        \"eventN"]],"start1":1805,"start2":1805,"length1":32,"length2":33},{"diffs":[[0,"n_room\","],[1,"\r"],[0,"\n       "]],"start1":1848,"start2":1848,"length1":16,"length2":17},{"diffs":[[0,"        \"data\":{"],[1,"\r"],[0,"\n          \"room"]],"start1":1858,"start2":1858,"length1":32,"length2":33},{"diffs":[[0,"m\": room"],[1,"\r"],[0,"\n       "]],"start1":1890,"start2":1890,"length1":16,"length2":17},{"diffs":[[0," room\r\n        }"],[1,"\r"],[0,"\n      }), funct"]],"start1":1893,"start2":1893,"length1":32,"length2":33},{"diffs":[[0,"function(error){"],[1,"\r"],[0,"\n          if(er"]],"start1":1921,"start2":1921,"length1":32,"length2":33},{"diffs":[[0,"ole.log(error);}"],[1,"\r"],[0,"\n        });\n\n  "]],"start1":1963,"start2":1963,"length1":32,"length2":33},{"diffs":[[0,");}\r\n        });"],[-1,"\n"],[1,"\r\n\r"],[0,"\n      rtc._sock"]],"start1":1976,"start2":1976,"length1":33,"length2":35},{"diffs":[[0,"n(msg) {"],[1,"\r"],[0,"\n       "]],"start1":2033,"start2":2033,"length1":16,"length2":17},{"diffs":[[0,"e(msg.data);"],[1,"\r"],[0,"\n        rtc"]],"start1":2071,"start2":2071,"length1":24,"length2":25},{"diffs":[[0," json.data);"],[1,"\r"],[0,"\n      };\n\n "]],"start1":2117,"start2":2117,"length1":24,"length2":25},{"diffs":[[0,"data);\r\n      };"],[-1,"\n"],[1,"\r\n\r"],[0,"\n      rtc._sock"]],"start1":2123,"start2":2123,"length1":33,"length2":35},{"diffs":[[0,"n(err) {"],[1,"\r"],[0,"\n       "]],"start1":2178,"start2":2178,"length1":16,"length2":17},{"diffs":[[0,"error');"],[1,"\r"],[0,"\n       "]],"start1":2211,"start2":2211,"length1":16,"length2":17},{"diffs":[[0,"og(err);"],[1,"\r"],[0,"\n      }"]],"start1":2238,"start2":2238,"length1":16,"length2":17},{"diffs":[[0,"(err);\r\n      };"],[-1,"\n"],[1,"\r\n\r"],[0,"\n      rtc._sock"]],"start1":2240,"start2":2240,"length1":33,"length2":35},{"diffs":[[0,"function(data) {"],[1,"\r"],[0,"\n        rtc.fir"]],"start1":2288,"start2":2288,"length1":32,"length2":33},{"diffs":[[0,"_socket.id);"],[1,"\r"],[0,"\n        del"]],"start1":2348,"start2":2348,"length1":24,"length2":25},{"diffs":[[0,"ket.id];"],[1,"\r"],[0,"\n      }"]],"start1":2405,"start2":2405,"length1":16,"length2":17},{"diffs":[[0,"];\r\n      };"],[-1,"\n"],[1,"\r\n\r"],[0,"\n      rtc.o"]],"start1":2411,"start2":2411,"length1":25,"length2":27},{"diffs":[[0,"function(data) {"],[1,"\r"],[0,"\n        rtc.con"]],"start1":2453,"start2":2453,"length1":32,"length2":33},{"diffs":[[0,"connections;"],[1,"\r"],[0,"\n        // "]],"start1":2502,"start2":2502,"length1":24,"length2":25},{"diffs":[[0,"ss peers"],[1,"\r"],[0,"\n       "]],"start1":2556,"start2":2556,"length1":16,"length2":17},{"diffs":[[0,"ctions);"],[1,"\r"],[0,"\n      }"]],"start1":2607,"start2":2607,"length1":16,"length2":17},{"diffs":[[0,"ons);\r\n      });"],[-1,"\n"],[1,"\r\n\r"],[0,"\n      rtc.on('r"]],"start1":2610,"start2":2610,"length1":33,"length2":35},{"diffs":[[0,"tion(data) {"],[1,"\r"],[0,"\n    \tvar ca"]],"start1":2672,"start2":2672,"length1":24,"length2":25},{"diffs":[[0,"idate(data);"],[1,"\r"],[0,"\n    \trtc.pe"]],"start1":2721,"start2":2721,"length1":24,"length2":25},{"diffs":[[0,"(candidate);"],[1,"\r"],[0,"\n        rtc"]],"start1":2790,"start2":2790,"length1":24,"length2":25},{"diffs":[[0," candidate);"],[1,"\r"],[0,"\n      });\n\n"]],"start1":2845,"start2":2845,"length1":24,"length2":25},{"diffs":[[0,"ate);\r\n      });"],[-1,"\n"],[1,"\r\n\r"],[0,"\n      rtc.on('n"]],"start1":2852,"start2":2852,"length1":33,"length2":35},{"diffs":[[0,"function(data) {"],[1,"\r"],[0,"\n        rtc.con"]],"start1":2907,"start2":2907,"length1":32,"length2":33},{"diffs":[[0,"cketId);"],[-1,"\n"],[1,"\r\n\r"],[0,"\n       "]],"start1":2961,"start2":2961,"length1":17,"length2":19},{"diffs":[[0,"(data.socketId);"],[1,"\r"],[0,"\n        for (va"]],"start1":3014,"start2":3014,"length1":32,"length2":33},{"diffs":[[0,"ngth; i++) {"],[1,"\r"],[0,"\n          v"]],"start1":3074,"start2":3074,"length1":24,"length2":25},{"diffs":[[0,".streams[i];"],[1,"\r"],[0,"\n          p"]],"start1":3114,"start2":3114,"length1":24,"length2":25},{"diffs":[[0,"dStream(stream);"],[1,"\r"],[0,"\n        }\n     "]],"start1":3143,"start2":3143,"length1":32,"length2":33},{"diffs":[[0,"eam);\r\n        }"],[1,"\r"],[0,"\n      });\n\n    "]],"start1":3154,"start2":3154,"length1":32,"length2":33},{"diffs":[[0,"    }\r\n      });"],[-1,"\n"],[1,"\r\n\r"],[0,"\n      rtc.on('r"]],"start1":3165,"start2":3165,"length1":33,"length2":35},{"diffs":[[0,"ata) {  "],[1,"\r"],[0,"\n       "]],"start1":3233,"start2":3233,"length1":16,"length2":17},{"diffs":[[0,"a.socketId);"],[1,"\r"],[0,"\n        del"]],"start1":3284,"start2":3284,"length1":24,"length2":25},{"diffs":[[0,"a.socketId];"],[1,"\r"],[0,"\n      });\n\n"]],"start1":3336,"start2":3336,"length1":24,"length2":25},{"diffs":[[0,"tId];\r\n      });"],[-1,"\n"],[1,"\r\n\r"],[0,"\n      rtc.on('r"]],"start1":3343,"start2":3343,"length1":33,"length2":35},{"diffs":[[0,"function(data) {"],[1,"\r"],[0,"\n        rtc.rec"]],"start1":3393,"start2":3393,"length1":32,"length2":33},{"diffs":[[0,"etId, data.sdp);"],[1,"\r"],[0,"\n        rtc.fir"]],"start1":3445,"start2":3445,"length1":32,"length2":33},{"diffs":[[0,"e offer', data);"],[1,"\r"],[0,"\n      });\n\n    "]],"start1":3487,"start2":3487,"length1":32,"length2":33},{"diffs":[[0,"ata);\r\n      });"],[-1,"\n"],[1,"\r\n\r"],[0,"\n      rtc.on('r"]],"start1":3498,"start2":3498,"length1":33,"length2":35},{"diffs":[[0,"tion(data) {"],[1,"\r"],[0,"\n        rtc"]],"start1":3553,"start2":3553,"length1":24,"length2":25},{"diffs":[[0,"ta.sdp);"],[1,"\r"],[0,"\n       "]],"start1":3610,"start2":3610,"length1":16,"length2":17},{"diffs":[[0,"wer', data);"],[1,"\r"],[0,"\n      });\n\n"]],"start1":3649,"start2":3649,"length1":24,"length2":25},{"diffs":[[0,"     });"],[-1,"\n"],[1,"\r\n\r"],[0,"\n      r"]],"start1":3664,"start2":3664,"length1":17,"length2":19},{"diffs":[[0,"t');"],[1,"\r"],[0,"\n    };"],[1,"\r"],[0,"\n  };"],[-1,"\n\n"],[1,"\r\n\r\n\r"],[0,"\n  r"]],"start1":3698,"start2":3698,"length1":22,"length2":27},{"diffs":[[0,"s = function() {"],[1,"\r"],[0,"\n    for (var i "]],"start1":3737,"start2":3737,"length1":32,"length2":33},{"diffs":[[0," i < len; i++) {"],[1,"\r"],[0,"\n      var socke"]],"start1":3804,"start2":3804,"length1":32,"length2":33},{"diffs":[[0,"nections[i];"],[1,"\r"],[0,"\n      rtc.s"]],"start1":3850,"start2":3850,"length1":24,"length2":25},{"diffs":[[0,"cketId);"],[1,"\r"],[0,"\n    }"],[1,"\r"],[0,"\n  }"],[-1,"\n"],[1,"\r\n\r"],[0,"\n  rtc.o"]],"start1":3886,"start2":3886,"length1":27,"length2":31},{"diffs":[[0,"tion(data) {"],[1,"\r"],[0,"\n    rtc.on("]],"start1":3930,"start2":3930,"length1":24,"length2":25},{"diffs":[[0,"function() {"],[1,"\r"],[0,"\n      rtc.f"]],"start1":3971,"start2":3971,"length1":24,"length2":25},{"diffs":[[0,"ta);"],[1,"\r"],[0,"\n    });"],[1,"\r"],[0,"\n  }"],[-1,"\n"],[1,"\r\n\r"],[0,"\n  r"]],"start1":4018,"start2":4018,"length1":21,"length2":25},{"diffs":[[0,"s = function() {"],[1,"\r"],[0,"\n    for (var i "]],"start1":4066,"start2":4066,"length1":32,"length2":33},{"diffs":[[0,"ngth; i++) {"],[1,"\r"],[0,"\n      rtc.c"]],"start1":4126,"start2":4126,"length1":24,"length2":25},{"diffs":[[0,"ons[i]);"],[1,"\r"],[0,"\n    }"],[1,"\r"],[0,"\n  };"],[-1,"\n"],[1,"\r\n\r"],[0,"\n  rtc.c"]],"start1":4183,"start2":4183,"length1":28,"length2":32},{"diffs":[[0,"nction(id) {"],[1,"\r"],[0,"\n    console"]],"start1":4239,"start2":4239,"length1":24,"length2":25},{"diffs":[[0,"ction');"],[1,"\r"],[0,"\n    var"]],"start1":4285,"start2":4285,"length1":16,"length2":17},{"diffs":[[0,"SERVER);"],[1,"\r"],[0,"\n    pc."]],"start1":4357,"start2":4357,"length1":16,"length2":17},{"diffs":[[0,"ion(event) {"],[1,"\r"],[0,"\n      if (e"]],"start1":4396,"start2":4396,"length1":24,"length2":25},{"diffs":[[0,"idate) {"],[1,"\r"],[0,"\n       "]],"start1":4430,"start2":4430,"length1":16,"length2":17},{"diffs":[[0,"JSON.stringify({"],[1,"\r"],[0,"\n           \"eve"]],"start1":4466,"start2":4466,"length1":32,"length2":33},{"diffs":[[0,"didate\","],[1,"\r"],[0,"\n       "]],"start1":4521,"start2":4521,"length1":16,"length2":17},{"diffs":[[0,"data\": {"],[1,"\r"],[0,"\n       "]],"start1":4543,"start2":4543,"length1":16,"length2":17},{"diffs":[[0,"e.label,"],[1,"\r"],[0,"\n       "]],"start1":4590,"start2":4590,"length1":16,"length2":17},{"diffs":[[0,"ndidate,"],[1,"\r"],[0,"\n       "]],"start1":4645,"start2":4645,"length1":16,"length2":17},{"diffs":[[0,"tId\": id"],[1,"\r"],[0,"\n       "]],"start1":4675,"start2":4675,"length1":16,"length2":17},{"diffs":[[0,"id\r\n           }"],[1,"\r"],[0,"\n         }), fu"]],"start1":4681,"start2":4681,"length1":32,"length2":33},{"diffs":[[0,"function(error){"],[1,"\r"],[0,"\n           if(e"]],"start1":4712,"start2":4712,"length1":32,"length2":33},{"diffs":[[0,"error);}"],[1,"\r"],[0,"\n       "]],"start1":4763,"start2":4763,"length1":16,"length2":17},{"diffs":[[0,"         });"],[1,"\r"],[0,"\n       }\n  "]],"start1":4773,"start2":4773,"length1":24,"length2":25},{"diffs":[[0,"   });\r\n       }"],[1,"\r"],[0,"\n       rtc.fire"]],"start1":4779,"start2":4779,"length1":32,"length2":33},{"diffs":[[0,"te);"],[1,"\r"],[0,"\n     };"],[-1,"\n"],[1,"\r\n\r"],[0,"\n   "]],"start1":4843,"start2":4843,"length1":17,"length2":20},{"diffs":[[0,"function() {"],[1,"\r"],[0,"\n      // TO"]],"start1":4876,"start2":4876,"length1":24,"length2":25},{"diffs":[[0,"inalize this API"],[1,"\r"],[0,"\n      rtc.fire("]],"start1":4906,"start2":4906,"length1":32,"length2":33},{"diffs":[[0,"pened');"],[1,"\r"],[0,"\n    };"],[-1,"\n"],[1,"\r\n\r"],[0,"\n    pc."]],"start1":4957,"start2":4957,"length1":24,"length2":27},{"diffs":[[0,"event) {"],[1,"\r"],[0,"\n      /"]],"start1":5007,"start2":5007,"length1":16,"length2":17},{"diffs":[[0,"this API"],[1,"\r"],[0,"\n      r"]],"start1":5041,"start2":5041,"length1":16,"length2":17},{"diffs":[[0,"am, id);"],[1,"\r"],[0,"\n    };"],[1,"\r"],[0,"\n    ret"]],"start1":5097,"start2":5097,"length1":23,"length2":25},{"diffs":[[0,"turn pc;"],[1,"\r"],[0,"\n  };"],[-1,"\n"],[1,"\r\n\r"],[0,"\n  rtc.s"]],"start1":5121,"start2":5121,"length1":22,"length2":25},{"diffs":[[0,"tion(socketId) {"],[1,"\r"],[0,"\n    var pc = rt"]],"start1":5161,"start2":5161,"length1":32,"length2":33},{"diffs":[[0,"tions[socketId];"],[1,"\r"],[0,"\n    pc.createOf"]],"start1":5206,"start2":5206,"length1":32,"length2":33},{"diffs":[[0,"n_description) {"],[1,"\r"],[0,"\n    pc.setLocal"]],"start1":5259,"start2":5259,"length1":32,"length2":33},{"diffs":[[0,"on_description);"],[1,"\r"],[0,"\n    rtc._socket"]],"start1":5309,"start2":5309,"length1":32,"length2":33},{"diffs":[[0,"JSON.stringify({"],[1,"\r"],[0,"\n        \"eventN"]],"start1":5348,"start2":5348,"length1":32,"length2":33},{"diffs":[[0,"send_offer\","],[1,"\r"],[0,"\n        \"da"]],"start1":5388,"start2":5388,"length1":24,"length2":25},{"diffs":[[0,"        \"data\":{"],[1,"\r"],[0,"\n            \"so"]],"start1":5402,"start2":5402,"length1":32,"length2":33},{"diffs":[[0,"etId\": socketId,"],[1,"\r"],[0,"\n            \"sd"]],"start1":5437,"start2":5437,"length1":32,"length2":33},{"diffs":[[0,"sion_description"],[1,"\r"],[0,"\n            }\n "]],"start1":5477,"start2":5477,"length1":32,"length2":33},{"diffs":[[0,"n\r\n            }"],[1,"\r"],[0,"\n        }), fun"]],"start1":5492,"start2":5492,"length1":32,"length2":33},{"diffs":[[0,"function(error){"],[1,"\r"],[0,"\n            if("]],"start1":5522,"start2":5522,"length1":32,"length2":33},{"diffs":[[0,"sole.log(error);"],[1,"\r"],[0,"\n        }\n   })"]],"start1":5565,"start2":5565,"length1":32,"length2":33},{"diffs":[[0,"   }"],[1,"\r"],[0,"\n   });"],[1,"\r"],[0,"\n    });"],[1,"\r"],[0,"\n  };"],[-1,"\n\n"],[1,"\r\n\r\n\r"],[0,"\n  r"]],"start1":5588,"start2":5588,"length1":30,"length2":36},{"diffs":[[0,"socketId, sdp) {"],[1,"\r"],[0,"\n    var pc = rt"]],"start1":5651,"start2":5651,"length1":32,"length2":33},{"diffs":[[0,"tions[socketId];"],[1,"\r"],[0,"\n    pc.setRemot"]],"start1":5696,"start2":5696,"length1":32,"length2":33},{"diffs":[[0,"n(sdp));"],[1,"\r"],[0,"\n    rtc"]],"start1":5766,"start2":5766,"length1":16,"length2":17},{"diffs":[[0,"cketId);"],[1,"\r"],[0,"\n  };"],[-1,"\n\n"],[1,"\r\n\r\n\r"],[0,"\n  rtc.s"]],"start1":5797,"start2":5797,"length1":23,"length2":27},{"diffs":[[0,"(socketId) {"],[1,"\r"],[0,"\n    var pc "]],"start1":5844,"start2":5844,"length1":24,"length2":25},{"diffs":[[0,"tions[socketId];"],[1,"\r"],[0,"\n    pc.createAn"]],"start1":5885,"start2":5885,"length1":32,"length2":33},{"diffs":[[0,"ption) {"],[1,"\r"],[0,"\n    pc."]],"start1":5947,"start2":5947,"length1":16,"length2":17},{"diffs":[[0,"iption);"],[1,"\r"],[0,"\n    rtc"]],"start1":5997,"start2":5997,"length1":16,"length2":17},{"diffs":[[0,"ingify({"],[1,"\r"],[0,"\n       "]],"start1":6036,"start2":6036,"length1":16,"length2":17},{"diffs":[[0,"answer\","],[1,"\r"],[0,"\n       "]],"start1":6073,"start2":6073,"length1":16,"length2":17},{"diffs":[[0,"\"data\":{"],[1,"\r"],[0,"\n       "]],"start1":6091,"start2":6091,"length1":16,"length2":17},{"diffs":[[0,"ocketId,"],[1,"\r"],[0,"\n       "]],"start1":6126,"start2":6126,"length1":16,"length2":17},{"diffs":[[0,"cription"],[1,"\r"],[0,"\n       "]],"start1":6166,"start2":6166,"length1":16,"length2":17},{"diffs":[[0,"           }"],[1,"\r"],[0,"\n        }),"]],"start1":6177,"start2":6177,"length1":24,"length2":25},{"diffs":[[0,"(error){"],[1,"\r"],[0,"\n       "]],"start1":6211,"start2":6211,"length1":16,"length2":17},{"diffs":[[0,"(error);"],[1,"\r"],[0,"\n       "]],"start1":6254,"start2":6254,"length1":16,"length2":17},{"diffs":[[0,"       }"],[1,"\r"],[0,"\n   });"],[1,"\r"],[0,"\n    var"]],"start1":6265,"start2":6265,"length1":23,"length2":25},{"diffs":[[0,"ion;"],[1,"\r"],[0,"\n    });"],[1,"\r"],[0,"\n  };"],[-1,"\n\n"],[1,"\r\n\r\n\r"],[0,"\n  r"]],"start1":6316,"start2":6316,"length1":23,"length2":28},{"diffs":[[0,", sdp) {"],[1,"\r"],[0,"\n    var"]],"start1":6380,"start2":6380,"length1":16,"length2":17},{"diffs":[[0,"cketId];"],[1,"\r"],[0,"\n    pc."]],"start1":6425,"start2":6425,"length1":16,"length2":17},{"diffs":[[0,"n(sdp));"],[1,"\r"],[0,"\n  };"],[-1,"\n\n"],[1,"\r\n\r\n\r"],[0,"\n  rtc.c"]],"start1":6487,"start2":6487,"length1":23,"length2":27},{"diffs":[[0,"nFail) {"],[1,"\r"],[0,"\n    var"]],"start1":6554,"start2":6554,"length1":16,"length2":17},{"diffs":[[0,"options;"],[1,"\r"],[0,"\n    onS"]],"start1":6572,"start2":6572,"length1":16,"length2":17},{"diffs":[[0,"ccess ||"],[1,"\r"],[0,"\n    fun"]],"start1":6602,"start2":6602,"length1":16,"length2":17},{"diffs":[[0,"on() {};"],[1,"\r"],[0,"\n    onF"]],"start1":6622,"start2":6622,"length1":16,"length2":17},{"diffs":[[0,"nFail ||"],[1,"\r"],[0,"\n    fun"]],"start1":6646,"start2":6646,"length1":16,"length2":17},{"diffs":[[0,"on() {};"],[-1,"\n"],[1,"\r\n\r"],[0,"\n    if("]],"start1":6666,"start2":6666,"length1":17,"length2":19},{"diffs":[[0,"o && opt.video){"],[1,"\r"],[0,"\n      options ="]],"start1":6693,"start2":6693,"length1":32,"length2":33},{"diffs":[[0,"     options = {"],[1,"\r"],[0,"\n        video: "]],"start1":6712,"start2":6712,"length1":32,"length2":33},{"diffs":[[0,"    video: true,"],[1,"\r"],[0,"\n        audio: "]],"start1":6734,"start2":6734,"length1":32,"length2":33},{"diffs":[[0,"     audio: true"],[1,"\r"],[0,"\n      };\n    }e"]],"start1":6755,"start2":6755,"length1":32,"length2":33},{"diffs":[[0,": true\r\n      };"],[1,"\r"],[0,"\n    }else if(op"]],"start1":6765,"start2":6765,"length1":32,"length2":33},{"diffs":[[0,".video){"],[1,"\r"],[0,"\n      o"]],"start1":6799,"start2":6799,"length1":16,"length2":17},{"diffs":[[0,"     options = {"],[1,"\r"],[0,"\n        video: "]],"start1":6810,"start2":6810,"length1":32,"length2":33},{"diffs":[[0,"o: true,"],[1,"\r"],[0,"\n       "]],"start1":6840,"start2":6840,"length1":16,"length2":17},{"diffs":[[0,"    audio: false"],[1,"\r"],[0,"\n      };\n    }e"]],"start1":6854,"start2":6854,"length1":32,"length2":33},{"diffs":[[0," false\r\n      };"],[1,"\r"],[0,"\n    }else if(op"]],"start1":6864,"start2":6864,"length1":32,"length2":33},{"diffs":[[0,".audio){"],[1,"\r"],[0,"\n      o"]],"start1":6898,"start2":6898,"length1":16,"length2":17},{"diffs":[[0,"     options = {"],[1,"\r"],[0,"\n        video: "]],"start1":6909,"start2":6909,"length1":32,"length2":33},{"diffs":[[0,"   video: false,"],[1,"\r"],[0,"\n        audio: "]],"start1":6932,"start2":6932,"length1":32,"length2":33},{"diffs":[[0,"io: true"],[1,"\r"],[0,"\n      }"]],"start1":6961,"start2":6961,"length1":16,"length2":17},{"diffs":[[0,"ue\r\n      };"],[1,"\r"],[0,"\n    }else {"]],"start1":6967,"start2":6967,"length1":24,"length2":25},{"diffs":[[0,"\n    }else {"],[1,"\r"],[0,"\n      optio"]],"start1":6980,"start2":6980,"length1":24,"length2":25},{"diffs":[[0,"ions = {"],[1,"\r"],[0,"\n       "]],"start1":7003,"start2":7003,"length1":16,"length2":17},{"diffs":[[0,": false,"],[1,"\r"],[0,"\n       "]],"start1":7026,"start2":7026,"length1":16,"length2":17},{"diffs":[[0,"o: false"],[1,"\r"],[0,"\n      }"]],"start1":7048,"start2":7048,"length1":16,"length2":17},{"diffs":[[0,"      };"],[1,"\r"],[0,"\n    }"],[-1,"\n"],[1,"\r\n\r"],[0,"\n    if "]],"start1":7058,"start2":7058,"length1":23,"length2":26},{"diffs":[[0,"Media) {"],[1,"\r"],[0,"\n      r"]],"start1":7092,"start2":7092,"length1":16,"length2":17},{"diffs":[[0,"umStreams++;"],[1,"\r"],[0,"\n      getUs"]],"start1":7113,"start2":7113,"length1":24,"length2":25},{"diffs":[[0,"tream) {"],[1,"\r"],[0,"\n       "]],"start1":7181,"start2":7181,"length1":16,"length2":17},{"diffs":[[0,"        "],[1,"\r"],[0,"\n       "]],"start1":7191,"start2":7191,"length1":16,"length2":17},{"diffs":[[0,"ms.push(stream);"],[1,"\r"],[0,"\n        rtc.ini"]],"start1":7218,"start2":7218,"length1":32,"length2":33},{"diffs":[[0,"reams++;"],[1,"\r"],[0,"\n       "]],"start1":7261,"start2":7261,"length1":16,"length2":17},{"diffs":[[0,"ess(stream);"],[1,"\r"],[0,"\n        if "]],"start1":7285,"start2":7285,"length1":24,"length2":25},{"diffs":[[0,"umStreams) {"],[1,"\r"],[0,"\n          r"]],"start1":7343,"start2":7343,"length1":24,"length2":25},{"diffs":[[0,"ready');"],[1,"\r"],[0,"\n       "]],"start1":7377,"start2":7377,"length1":16,"length2":17},{"diffs":[[0,";\r\n        }"],[1,"\r"],[0,"\n      }, fu"]],"start1":7384,"start2":7384,"length1":24,"length2":25},{"diffs":[[0,"function() {"],[1,"\r"],[0,"\n        ale"]],"start1":7407,"start2":7407,"length1":24,"length2":25},{"diffs":[[0,"ream.\");"],[1,"\r"],[0,"\n       "]],"start1":7456,"start2":7456,"length1":16,"length2":17},{"diffs":[[0,"nFail();"],[1,"\r"],[0,"\n      }"]],"start1":7475,"start2":7475,"length1":16,"length2":17},{"diffs":[[0,"     });"],[1,"\r"],[0,"\n    } e"]],"start1":7486,"start2":7486,"length1":16,"length2":17},{"diffs":[[0,"} else {"],[1,"\r"],[0,"\n      a"]],"start1":7500,"start2":7500,"length1":16,"length2":17},{"diffs":[[0,".');"],[1,"\r"],[0,"\n    }"],[1,"\r"],[0,"\n  }"],[-1,"\n\n"],[1,"\r\n\r\n\r"],[0,"\n  r"]],"start1":7566,"start2":7566,"length1":20,"length2":25},{"diffs":[[0,"function() {"],[1,"\r"],[0,"\n    for (va"]],"start1":7607,"start2":7607,"length1":24,"length2":25},{"diffs":[[0,"; i++) {"],[1,"\r"],[0,"\n      v"]],"start1":7663,"start2":7663,"length1":16,"length2":17},{"diffs":[[0,"eams[i];"],[1,"\r"],[0,"\n      f"]],"start1":7699,"start2":7699,"length1":16,"length2":17},{"diffs":[[0,"tions) {"],[1,"\r"],[0,"\n       "]],"start1":7752,"start2":7752,"length1":16,"length2":17},{"diffs":[[0,"am);"],[1,"\r"],[0,"\n      }"],[1,"\r"],[0,"\n    }"],[1,"\r"],[0,"\n  };"],[-1,"\n\n"],[1,"\r\n\r\n\r"],[0,"\n  r"]],"start1":7816,"start2":7816,"length1":29,"length2":35},{"diffs":[[0,"domId) {"],[1,"\r"],[0,"\n    doc"]],"start1":7886,"start2":7886,"length1":16,"length2":17},{"diffs":[[0,"am);"],[1,"\r"],[0,"\n  };"],[-1,"\n"],[1,"\r\n\r"],[0,"\n  r"]],"start1":7961,"start2":7961,"length1":14,"length2":17},{"diffs":[[0,"tion() {"],[1,"\r"],[0,"\n    rtc"]],"start1":7997,"start2":7997,"length1":16,"length2":17},{"diffs":[[0,"nnections();"],[1,"\r"],[0,"\n    rtc.add"]],"start1":8027,"start2":8027,"length1":24,"length2":25},{"diffs":[[0,"reams();"],[1,"\r"],[0,"\n    rtc"]],"start1":8054,"start2":8054,"length1":16,"length2":17},{"diffs":[[0,"s();"],[1,"\r"],[0,"\n  });"],[-1,"\n"],[1,"\r\n\r"],[0,"\n})."]],"start1":8081,"start2":8081,"length1":15,"length2":18},{"diffs":[[0,"l(this);"],[1,"\r"],[0,"\n"]],"start1":8102,"start2":8102,"length1":9,"length2":10}]],"length":8112,"saved":false}
{"ts":1354727546685,"patch":[[{"diffs":[[0,"lized.\r\n"],[-1,"\t"],[1,"    "],[0,"\r\nvar Pe"]],"start1":78,"start2":78,"length1":17,"length2":20},{"diffs":[[0,"n ||"],[-1," window.webkitPeerConnection00 ||"],[0," win"]],"start1":133,"start2":133,"length1":41,"length2":8},{"diffs":[[0,"= null;\r"],[1,"\n  \r\n  // Holds identity for the client\r\n  rtc._me = null;\r"],[0,"\n\r\n  // "]],"start1":583,"start2":583,"length1":16,"length2":75},{"diffs":[[0,"nnections;\r\n"],[1,"        rtc._me = data.you;\r\n"],[0,"        // f"]],"start1":2533,"start2":2533,"length1":24,"length2":53},{"diffs":[[0," {\r\n    "],[-1,"\t"],[1,"    "],[0,"var cand"]],"start1":2740,"start2":2740,"length1":17,"length2":20},{"diffs":[[0,"l(this);"],[-1,"\r\n"]],"start1":8163,"start2":8163,"length1":10,"length2":8}]],"length":8171,"saved":false}
{"contributors":[],"silentsave":true,"ts":1354727751519,"patch":[[{"diffs":[[0,"rtc;\r\n  "],[1,"//"],[0,"if ('und"]],"start1":403,"start2":403,"length1":16,"length2":18}]],"length":8173,"saved":false}
{"ts":1354727754231,"patch":[[{"diffs":[[0," {};\r\n  "],[1,"//"],[0,"} else {"]],"start1":471,"start2":471,"length1":16,"length2":18},{"diffs":[[0,"else {\r\n    "],[1,"//"],[0,"rtc = module"]],"start1":483,"start2":483,"length1":24,"length2":26},{"diffs":[[0,"ts = {};\r\n  "],[1,"//"],[0,"}\r\n\r\n \r\n  //"]],"start1":515,"start2":515,"length1":24,"length2":26}]],"length":8179,"saved":false}
{"ts":1354727822062,"patch":[[{"diffs":[[0,"rtc;\r\n  "],[-1,"//"],[0,"if ('und"]],"start1":403,"start2":403,"length1":18,"length2":16},{"diffs":[[0," {};\r\n  "],[-1,"//"],[0,"} else {"]],"start1":469,"start2":469,"length1":18,"length2":16},{"diffs":[[0," {\r\n    "],[-1,"//"],[0,"rtc = mo"]],"start1":483,"start2":483,"length1":18,"length2":16},{"diffs":[[0," {};\r\n  "],[-1,"//"],[0,"}\r\n\r\n \r\n"]],"start1":513,"start2":513,"length1":18,"length2":16}]],"length":8171,"saved":false}
